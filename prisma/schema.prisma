generator client {
  provider            = "prisma-client"
  output              = "../generated/prisma"
  importFileExtension = ""
  previewFeatures     = ["views"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName String?
  lastName  String?
  email     String?  @unique
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  profile   Profile?
}

model Profile {
  id                    String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userType              UserType?
  userId                String        @unique @db.Uuid
  bio                   String?
  locationId            Int?
  occupationId          Int?
  updatedAt             DateTime      @default(now())
  gender                Gender?
  sameGenderPref        Boolean?
  linkedInUrl           String?
  githubUrl             String?
  buyMeCoffeeUrl        String?
  yearsOfExperience     Int?
  calendlyUserUri       String?       @unique
  onboardingCompleted   Boolean       @default(false)
  location              Location?     @relation(fields: [locationId], references: [id])
  occupation            Occupation?   @relation(fields: [occupationId], references: [id])
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  calendlyUser          CalendlyUser?
  skills                Skill[]       @relation("ProfileSkills")
  mentorSessions        Session[]     @relation("MentorSessions")
  menteeSessions        Session[]     @relation("MenteeSessions")
}

model Location {
  id      Int       @id @default(autoincrement())
  city    String?
  country String?
  profile Profile[]

  @@unique([city, country])
}

model Occupation {
  id      Int       @id @default(autoincrement())
  role    String?
  company String?
  profile Profile[]

  @@unique([role, company])
}

model CalendlyUser {
  uri                  String   @id
  profileId            String   @unique @db.Uuid
  name                 String?
  slug                 String?
  email                String?
  scheduling_url       String?  @unique
  timezone             String?
  avatar_url           String?
  created_at           DateTime @default(now())
  updated_at           DateTime @default(now())
  current_organization String?
  resource_type        String?
  accessToken          String?
  refreshToken         String?
  webhookUri           String?
  profile              Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Session {
  id               String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  calendlyEventUri String        @unique
  eventName        String?
  startTime        DateTime
  endTime          DateTime
  status           SessionStatus @default(ACTIVE)
  mentorProfileId  String        @db.Uuid
  mentorProfile    Profile       @relation("MentorSessions", fields: [mentorProfileId], references: [id], onDelete: Cascade)
  menteeProfileId  String        @db.Uuid
  menteeProfile    Profile       @relation("MenteeSessions", fields: [menteeProfileId], references: [id], onDelete: Cascade)
  createdAt        DateTime      @default(now())
  canceledAt       DateTime?
}

enum SessionStatus {
  ACTIVE
  CANCELED
}

model Skill {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  category String?
  profiles Profile[] @relation("ProfileSkills")
}

view MentorProfile {
  id                    String    @unique
  userType              UserType?
  firstName             String?
  lastName              String?
  bio                   String?
  image                 String?
  calendlySchedulingUrl String?
  gender                Gender?
  sameGenderPref        Boolean?
  city                  String?
  country               String?
  role                  String?
  yearsOfExperience     Int?
  company               String?
  linkedInUrl           String?
  githubUrl             String?
  buyMeCoffeeUrl        String?
}

enum UserType {
  MENTOR
  MENTEE
}

enum Gender {
  MALE
  FEMALE
}
